<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="
          http://www.liquibase.org/xml/ns/dbchangelog
          http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.20.xsd">

    <!-- ===================== -->
    <!-- USERS TABLE FOR JWT AUTH -->
    <!-- ===================== -->
    <changeSet id="006-create-users-table" author="herbet">
        <sql>
            CREATE TABLE users (
                id BIGSERIAL PRIMARY KEY,
                username VARCHAR(100) NOT NULL UNIQUE,
                password VARCHAR(255) NOT NULL,
                email VARCHAR(100) NOT NULL,
                ativo BOOLEAN NOT NULL DEFAULT TRUE,
                roles VARCHAR(50) NOT NULL DEFAULT 'USER'
            );
        </sql>
    </changeSet>

    <!-- Insert default admin user -->
    <changeSet id="007-insert-default-admin-user" author="herbet">
        <sql>
            INSERT INTO users (username, password, email, ativo, roles) 
            VALUES ('admin', '$2a$10$tSgZHw2lu.dNDwZK3NEBtOjJxhyi6nbePVmAaG6vmYM6cwDtlDnnS', 'admin@example.com', true, 'ADMIN')
            ON CONFLICT (username) DO NOTHING;
        </sql>
    </changeSet>

</databaseChangeLog>
